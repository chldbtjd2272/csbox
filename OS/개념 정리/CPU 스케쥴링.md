# CPU 스케줄링
## 01. 기본 개념
**다중 프로그래밍** 은 여러 프로그램을 메모리에 적재한다.  
프로세서( CPU )를 분할 사용하여 프로세서 효율성을 향상시킨다.

**스케줄링** 이란, 프로세스들을 프로세서에 할당하는 일련의 과정을 의미한다.  
- 각 프로세스의 실행 여부를 결정
    - -> 시스템 성능에 영향을 미침
- 입출력과 계산의 중복
- 시스템의 작업 처리 능력을 향상 및 작업의 응답 시간을 최소화

프로세스 실행은 CPU 실행과 입출력 대기의 순환으로 구성된다.
- CPU 버스트(burst)로 시작하여 CPU 버스트로 끝남

프로세스의 종류
- 입출력 중심 프로세스
    - 대부분의 시간을 입출력에 소비
- 프로세서(CPU) 중심 프로세스 : 대부분의 시간을 연산하는데 소비

- 대부분의 프로세스들은 입출력 중심 프로세스와 프로세서 중심 프로세스로 구성된다
- 시스템의 성능을 좋게 하려면 두 종류의 프로세스를 적절히 혼합하여 선택해야 한다

스케줄러의 종류
- 장기 (프로세스) 스케줄러
    - 프로세스의 생성 과정에서 프로세스의 준비상태에 무엇을 추가할 지 결정한다.
- 중기 스케줄러
    - 작업의 혼합 개선 또는 메모리 가용량 증가를 위해 교체 작업을 진행한다.
- 단기 (CPU) 스케줄러
    - 미리 정해진 정책(알고리즘)에 따라 실행할 프로세스를 선택한다.
    - CPU가 유휴(idle) 상태가 되면, 준비 큐에 있는 프로세스 하나를 실행한다.
    - 준비 큐는 다양한 형태를 할 수 있다.
        - 선입선출 큐, 우선순위 큐, 트리 또는 연결 리스트 등으로 구현
        - 보통 프로세스들의 PCB로 구성됨

비선점 스케줄링(Nonpreemptive Scheduling)
- 다른 프로세스에 할당된 자원을 빼앗을 수 없는 스케줄링
- 우선 순위가 높은 작업들이 중간에 입력되어도 대기중인 작업들은 영향을 받지 않아 응답시간 예측이 쉬움

선점 스케줄링(Preemptive Scheduling)
- 현재 실행 중인 프로세스를 인터럽트 할 수 있거나 준비상태로 이동시킬 수 있는 스케줄링
- 우선순위가 높은 프로세스들이 긴급한 처리를 요청할 때 유용함
- 선점을 효과적으로 하기 위해 메인 메모리에 많은 프로세스들이 저장되어 있어야 하므로 많은 오버헤드를 초래함

디스패쳐(Dispatcher)
- CPU 스케줄러(단기 스케줄러)에 포함된 요소
- 분배기
- 단기 스케줄러가 선택한 프로세스에 실질적으로 CPU에 할당
- 문맥 교환을 수행하고 사용자 모드로 전환
- 디스패쳐 지연
    - 한 프로세스를 멈추고 다른 프로세스를 시작하는 데까지 소요되는 시간

## 02. 스케줄링 기준
스케줄링 알고리즘의 비교 기준
- CPU 이용률
- 처리량 또는 작업 처리율 : 단위 시간당 완료된 작업 수
- 총처리 시간 또는 반환 시간 : 기계에 진입한 시간과 완료한 시간의 차이
- 대기 시간 : 준비 큐에서 대기하는 시간
- 응답 시간 또는 반응 시간 : 요청을 제출하고부터 첫번째 응답이 나올 때까지의 시간

## 03. 스케줄링 알고리즘
### 선입 선처리 스케줄링(FCFS)
**선입 선처리 스케줄링** (First-Come-First-Served) 이란? 프로세서를 요구 순서대로 할당하는 알고리즘이다.
- 비선점 기법 (프로세서 스케줄링 알고리즘 중 가장 간단)
- 선입선출(FIFO) 큐로 구현
- 일괄 처리 시스템에는 효율적
- 대화식 시스템에서는 사용자의 빠른 응답 요구에 부적합

### 최단 작업 우선 스케줄링(SJF)
**최단 작업 우선 스케줄링** 이란? CPU 버스트 시간이 가장 짧은 작업에 CPU를 할당하는 알고리즘이다.
- 동일한 실행시간을 가진다면 선입 선처리 스케줄링 적용
- 주어진 작업 집합에 대해 평균 대기시간을 최소화하는 알고리즘
- 문제점
    - 실행 시간의 길이 예측이 힘듬
        - 최단 작업 우선 스케줄링에 근사하도록 시도
- 선점 / 비선점이 모두 가능하다

### 우선순위 스케줄링(Priority)
**우선순위 스케줄링** 이란? 최고 우선순위의 프로세스에 CPU를 할당하는 알고리즘이다.
- 최단 작업 우선 알고리즘은 우선순위 알고리즘에 속함
- 선점 / 비선점이 모두 가능하다
- **기아 상태** 발생 가능
    - **기아 상태** 란? 우선 순위가 높은 프로세스들이 계속 들어오면 우선 순위가 낮은 프로세스들이 무한정 기다려야 하는 상태
    - => 해결 방법 : 에이징
        - 오랫동안 시스템에서 대기하는 프로세스들의 우선순위를 점진적으로 증가시키는 기법

### 라운드 로빈 스케줄링(Round Robin)
**라운드 로빈 스케줄링** 이란? 순환 할당 스케줄링으로, 시분할 시스템을 위해 설계된 알고리즘이다.
- 규정 시간량 또는 시간 할당량을 정의한다
- 시간 할당량은 일반적으로 100 밀리 초 전후로 정의
- 준비 큐는 FIFO 큐이면 순환 큐로 설계한다
- 규정 시간량이 지나면 인터럽트가 발생되며 문맥교환을 수행한다
- 선점 알고리즘
- 성능은 규정 시간량의 크기에 영향을 받는다
    - 규정 시간량이 아주 클 경우
        - 작업을 완료할 충분한 시간을 얻고 순환 할당 방식이 선입 선처리 방식으로 변함
        - 작업시간이 긴 프로세스들 때문에 작업시간이 짧은 프로세스들이 대기한다 -> 평균 대기시간이 길어짐
    - 규정 시간량이 매우 작은 경우
        - 마치 n개의 프로세스가 실제 프로세서 속도의 1/n의 속도로 실행되는 것처럼 보임
        - 문맥교환 횟수 증가 : 프로세서 유휴시간 증가
    - 최적의 규정 시간량의 크기는 시스템 특성 및 오버헤드, 프로세스에 따라 다름
- 반환시간도 규정 시간량의 크기에 영향을 받음
- 반환시간이 규정 시간량의 크기에 항상 반비례하지는 않음
  
### 다단계 큐 스케줄링(Multilevel Queue)
**다단계 큐 스케줄링** 이란? 각 작업들을 서로 다른 묶음으로 분류할 수 있을 때 사용하는 알고리즘이다.
- 준비상태 큐를 종류별로 여러 단계로 분할한다.
- 작업을 기억장치의 크기나 프로세스의 형태에 따라 한 큐에 지정한다.
- 각 큐는 자신만의 독자적인 스케줄링 알고리즘을 갖는다.
- 큐 사이에도 스케줄링이 있음 : 고정된 우선순위의 선점식 스케줄링
- 큐들 사이에 시간을 나누어 사용 가능
    - 각 큐는 프로세서 시간의 일정량을 받아서 큐에 있는 프로세스들을 스케줄링
  
### 다단계 피드백 큐 스케줄링(Multilevel Queue with FeedBack)
**다단계 피드백 큐 스케줄링** 이란? 다단계 큐 스케줄링을 보안한 알고리즘이다.
- 다단계 큐
    - 작업이 시스템에 들어가면 한 큐에서만 고정
    - 스케줄링 부담이 적으나 융통성이 떨어짐
- 다단계 피드백 큐
    - 작업이 큐 사이를 이동할 수 있음
        - 어떤 작업이 요구하는 프로세서 시간이 너무 길면 작업을 낮은 단계 큐로 옮김
    - 기아상태 예방을 위한 에이징 방법 활용
    - 가장 일반적인 기법, 가장 복잡한 알고리즘

### HRN 스케줄링
**HRN(Highest Response-Rate Next) 스케줄링** 이란? SJF 기법의 약점인 긴 작업과 짧은 작업 가의 불평등을 보완한 기법을 나타내는 알고리즘이다.
- 비선점 스케줄링
- 가변적 우선순위 : 서비스 받을 시간 + 서비스를 기다린 시간
    - 서비스를 받을 시간이 짧은 작업이 우선순위가 높다
    - 서비스를 받을 시간이 긴 작업도 대기한 시간이 큰 경우에 우선순위가 높다

## 04. 다중처리기 스케줄링
다중 프로세서(다중처리기) 시스템의 스케줄링
- 동종 병렬컴퓨터(강결합)와 이기종 분산컴퓨터(약결합)로 구분 가능
- 여러 개의 CPU가 사용 가능하면 스케줄링 문제는 더욱 복잡해짐

전역 큐를 이용한 부하 공유
- 쉬고 있는 프로세서는 전역 큐에서 프로세스 하나를 선택
- 장점 : 부하, 프로세서들에 균등하게 분산
- 단점 : 전역 큐에 병목 현상 발생. 선점된 프로세스를 동일한 프로세서에서 재개하기 어려움

프로세서 독립 큐 사용
- 공동의 준비 큐를 통해 모든 작업이 프로세서 큐에 영구 배정

## 05. 실시간 스케줄링
프로세스 수행이 데드라인 이전에 완료 보장  
- 데드라인을 만족하는지 여부를 사전에 측정
    - 동작 이전에 데드라인 만족도가 예측 가능해야 함
- 빠른 평균 수행 시간이 데드라인을 만족하지 않음
    - 최대 수행 완료 시간이 데드라인을 만족해야 함

종류
- 경성(hard) 실시간 시스템
    - 실시간 작업들을 반드시 주어진 시간 내에 완료를 보장
- 연성(soft) 실시간 시스템
    - 실시간 작업들을 일정 수준 이상 주어진 시간 내에 완료하는 것을 보장